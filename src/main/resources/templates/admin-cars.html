<!DOCTYPE html>
<html lang="uk" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ê–≤—Ç–æ–ø–∞—Ä–∫ - –ê–¥–º—ñ–Ω –ü–∞–Ω–µ–ª—å</title>
    <link rel="stylesheet" th:href="@{/styles/client-styles.css}" />
    <link rel="stylesheet" th:href="@{/styles/admin.css}" />
</head>
<body>

<header class="header">
    <div class="logo"><a th:href="@{/}"><img th:src="@{/images/Logo.svg}" alt="" /></a></div>
    <nav class="header-navigation">
        <a th:href="@{/admin-crud}" style="color: #193948;">–¢–æ–≤–∞—Ä–∏</a>
        <a th:href="@{/admin/orders}" style="color: #193948;">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</a>
        <a th:href="@{/admin/cars}" style="font-weight: bold; color: #6a4821;">–ê–≤—Ç–æ–ø–∞—Ä–∫</a>
        <a th:href="@{/admin/stats}" style="color: #193948;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>

    </nav>
    <div class="header-user-actions">
        <svg class="ham hamRotate ham7" viewBox="0 0 100 100" onclick="toggleMobileMenu()" id="burger-btn">
            <path class="line top" d="m 70,33 h -40 c 0,0 -6,1.368796 -6,8.5 0,7.131204 6,8.5013 6,8.5013 l 20,-0.0013" />
            <path class="line middle" d="m 70,50 h -40" />
            <path class="line bottom" d="m 69.575405,67.073826 h -40 c -5.592752,0 -6.873604,-9.348582 1.371031,-9.348582 8.244634,0 19.053564,21.797129 19.053564,12.274756 l 0,-40" />
        </svg>
        <span style="font-weight: bold;cursor:auto; margin-right:10px;">–ê–¥–º—ñ–Ω –ü–∞–Ω–µ–ª—å</span>
        <a href="#" onclick="logout()" style="color: red; text-decoration: none;">–í–∏—Ö—ñ–¥</a>
    </div>
    <div id="mobileMenu">
        <div class="mobile-menu-content">
            <nav class="mobile-header-navigation">
                <a th:href="@{/admin-crud}">–¢–æ–≤–∞—Ä–∏</a>
                <a th:href="@{/admin/orders}">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</a>
                <a th:href="@{/admin/cars}" style="color: #6a4821;">–ê–≤—Ç–æ–ø–∞—Ä–∫</a>
                <a th:href="@{/admin/stats}">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
                <a href="#" onclick="logout()" style="color: red; text-decoration: none;">–í–∏—Ö—ñ–¥</a>
            </nav>
        </div>
    </div>
</header>

<main class="conteiner " style="display:flex; flex-direction:column;">
    <h2 class="section-title">üöö –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ê–≤—Ç–æ–ø–∞—Ä–∫–æ–º</h2>

    <form class="add-car-form" onsubmit="addCar(event)">
        <div class="form-col">
            <label>–ú–∞—Ä–∫–∞ –∞–≤—Ç–æ</label>
            <input type="text" id="model" placeholder="–ù–∞–ø—Ä: Toyota Prius" required>
        </div>
        <div class="form-col">
            <label>–ù–æ–º–µ—Ä–Ω–∏–π –∑–Ω–∞–∫</label>
            <input type="text" id="license" placeholder="AA 1234 BB" required>
        </div>
        <div class="form-col">
            <label>–í–æ–¥—ñ–π (–õ–æ–≥—ñ–Ω)</label>
            <input type="text" id="driver" placeholder="–í–≤–µ–¥—ñ—Ç—å –ª–æ–≥—ñ–Ω –≤–æ–¥—ñ—è" required>
        </div>
        <button type="submit" class="btn-create-new" style="margin: 0; width: 100%;">+ –î–æ–¥–∞—Ç–∏ –∞–≤—Ç–æ</button>
    </form>

    <div class="cars-grid">
        <div class="car-card" th:each="car : ${cars}">
            <div class="car-header">
                <div class="car-details">
                    <span class="car-model" th:text="${car.model}">Toyota Prius</span>
                    <div class="car-license" th:text="${car.licensePlate}">KA 7777 AH</div>
                </div>

                <select onchange="updateCarStatusJS(this)"
                        th:data-id="${car.id}"
                        class="status-select-car"
                        th:classappend="${car.status.name() == 'free' ? 'st-free' : (car.status.name() == 'busy' ? 'st-busy' : 'st-broken')}">

                    <option value="free" th:selected="${car.status.name() == 'free'}">üü¢ –í—ñ–ª—å–Ω–∞</option>
                    <option value="busy" th:selected="${car.status.name() == 'busy'}">üü† –ó–∞–π–Ω—è—Ç–∞</option>
                    <option value="at_repairs" th:selected="${car.status.name() == 'at_repairs'}">‚ö´ –†–µ–º–æ–Ω—Ç</option>
                </select>
            </div>

            <div class="car-info">
                <span class="car-icon">üë§</span>
                <span style="font-weight: 600;">–í–æ–¥—ñ–π:</span>
                <span th:text="${car.driver != null ? car.driver.name : '‚Äî'}"
                      th:data-login="${car.driver != null ? car.driver.login : ''}"
                      id="driver-name-display">
                      –Ü–≤–∞–Ω
                </span>
            </div>

            <div style="display: flex; gap: 10px; margin-top: auto;">
                <button type="button" class="btn-admin btn-edit"
                        th:data-id="${car.id}"
                        th:data-model="${car.model}"
                        th:data-license="${car.licensePlate}"
                        th:data-driver="${car.driver != null ? car.driver.login : ''}"
                        onclick="openEditCarModal(this)"> ‚úèÔ∏è –†–µ–¥.
                </button>

                <button type="button" class="btn-admin btn-delete" th:onclick="'deleteCar(' + ${car.id} + ')'">
                    üóë –í–∏–¥.
                </button>
            </div>
        </div>
    </div>
</main>

<div id="editCarModal" class="modal-overlay" style="display: none;">
    <div class="modal-content add-car-form" style="max-width: 400px; display: flex; gap:10px; flex-direction: column; margin: 0;">
        <h3>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–æ–±—ñ–ª—å</h3>
        <input type="hidden" id="edit-car-id">

        <label>–ú–∞—Ä–∫–∞</label>
        <input type="text" id="edit-model">

        <label>–ù–æ–º–µ—Ä</label>
        <input type="text" id="edit-license">

        <label>–õ–æ–≥—ñ–Ω –≤–æ–¥—ñ—è</label>
        <input type="text" id="edit-driver">

        <div class="modal-btns">
            <button type="button" onclick="closeEditCarModal()" class="btn-modal-cancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            <button type="button" onclick="submitEditCar()" class="btn-modal-save">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
        </div>
    </div>
</div>

<script th:src="@{/js/admin.js}"></script>
<script th:src="@{/js/client.js}"></script>
</body>
</html>