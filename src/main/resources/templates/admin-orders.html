<!DOCTYPE html>
<html lang="uk" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Замовлення - Адмін Панель</title>
    <link rel="stylesheet" th:href="@{/styles/client-styles.css}" />
    <link rel="stylesheet" th:href="@{/styles/admin.css}" />
</head>
<body>

<header class="header">
    <div class="logo"><a th:href="@{/}"><img th:src="@{/images/Logo.svg}" alt="" /></a></div>
    <nav class="header-navigation">
        <a th:href="@{/admin-crud}" style="color: #193948;">Товари</a>
        <a th:href="@{/admin/orders}" style="font-weight: bold; color: #6a4821;">Замовлення</a>
        <a th:href="@{/admin/cars}">Автопарк</a>
        <a th:href="@{/admin/ingredients}">Склад</a>
        <a th:href="@{/admin/recipes}">Рецепти</a>
        <a th:href="@{/admin/stats}">Статистика</a>
    </nav>
    <div class="header-user-actions">
        <svg class="ham hamRotate ham7" viewBox="0 0 100 100"  onclick="toggleMobileMenu()" id="burger-btn">
            <path class="line top" d="m 70,33 h -40 c 0,0 -6,1.368796 -6,8.5 0,7.131204 6,8.5013 6,8.5013 l 20,-0.0013" />
            <path class="line middle" d="m 70,50 h -40" />
            <path class="line bottom" d="m 69.575405,67.073826 h -40 c -5.592752,0 -6.873604,-9.348582 1.371031,-9.348582 8.244634,0 19.053564,21.797129 19.053564,12.274756 l 0,-40" />
        </svg>

        <a href="#" onclick="handleUserClick(event)"
           style="font-weight: bold; margin: 0 10px 0 0; cursor: pointer; text-decoration: none; color: inherit;text-align:center;">
            Адмін Панель
        </a>

        <a href="#" onclick="logout()" style="color: red; margin-left: 10px;">Вихід</a>
    </div>

    <div id="mobileMenu">
        <div class="mobile-menu-content">
            <nav class="mobile-header-navigation">
                <a th:href="@{/admin-crud}" style="color: #193948;">Товари</a>
                <a th:href="@{/admin/orders}" style="font-weight: bold; color: #6a4821;">Замовлення</a>
                <a th:href="@{/admin/cars}">Автопарк</a>
                <a th:href="@{/admin/stats}">Статистика</a>
                <a th:href="@{/admin/ingredients}">Склад</a>
                <a th:href="@{/admin/recipes}">Рецепти</a>
                <a href="#" onclick="logout()" style="color: red;">Вихід</a>
            </nav>
        </div>
    </div>
</header>

<main class="conteiner" style="display:flex; flex-direction:column; justify-content:start;">
    <h2 style="margin-top: 30px;">Список Замовлень</h2>

    <table class="orders-table">
        <thead>
        <tr>
            <th>ID</th>
            <th>Клієнт</th>
            <th>Адреса</th>
            <th>Склад замовлення</th>
            <th>Машина</th> <th>Сума</th>
            <th>Статус</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="order : ${orders}">
            <td data-label="ID" th:text="'#' + ${order.id}">#1</td>

            <td data-label="Клієнт">
                <div th:if="${order.client != null}">
                    <div th:text="${order.client.name}" style="font-weight: bold;">User Name</div>
                    <div th:text="${order.client.phone}" style="font-size: 12px; color: gray;">Phone</div>
                    <span style="font-size: 10px; background: #e3f2fd; color: #1976D2; padding: 2px 6px; border-radius: 4px;">Клієнт</span>
                </div>

                <div th:if="${order.client == null}">
                    <div th:text="${order.guestName}" style="font-weight: bold;">Guest Name</div>
                    <div th:text="${order.guestPhone}" style="font-size: 12px; color: gray;">Phone</div>
                    <span style="font-size: 10px; background: #f5f5f5; color: #666; padding: 2px 6px; border-radius: 4px;">Гість</span>
                </div>
            </td>

            <td data-label="Адреса" th:text="${order.deliveryAddress}">Київ</td>

            <td data-label="Склад" class="order-items" th:text="${order.items}">Маргарита, Кола</td>

            <td data-label="Машина">
                <select th:onchange="'assignCar(this, ' + ${order.id} + ')'"
                        class="status-select"
                        style=" border: 1px solid #ddd;">

                    <option value="">-- Не призначено --</option>

                    <option th:each="car : ${cars}"
                            th:value="${car.id}"
                            th:selected="${order.car != null && order.car.id == car.id}"
                            th:disabled="${car.status.name() != 'free' && (order.car == null || order.car.id != car.id)}"
                            th:style="${car.status.name() != 'free' && (order.car == null || order.car.id != car.id)} ? 'color: gray; background: #eee;' : ''"
                            th:text="${car.model} + ' (' + ${car.licensePlate} + ') - ' + (${car.status.name() == 'free'} ? 'Вільна' : 'ЗАЙНЯТА')">
                    </option>
                </select>
            </td>

            <td data-label="Сума" th:text="${order.totalAmount} + ' ₴'" style="font-weight: bold; color: #dc7002;">500 ₴</td>

            <td data-label="Статус">
                <select th:onchange="'updateOrderStatus(this, ' + ${order.id} + ')'"
                        class="status-select"
                        th:data-current="${order.status}">
                    <option value="new_order" th:selected="${order.status.name() == 'new_order'}">Нове</option>
                    <option value="being_cooked" th:selected="${order.status.name() == 'being_cooked'}">Готується</option>
                    <option value="being_delivered" th:selected="${order.status.name() == 'being_delivered'}">В дорозі</option>
                    <option value="delivered" th:selected="${order.status.name() == 'delivered'}">Доставлено</option>
                </select>
            </td>
        </tr>
        </tbody>
    </table>

    <div th:if="${#lists.isEmpty(orders)}" style="text-align: center; margin-top: 50px;">
        <h3>Замовлень поки немає</h3>
    </div>

</main>
<script th:src="@{/js/client.js}"></script>
<script th:src="@{/js/admin.js}"></script>
</body>
</html>